{%- liquid
  assign _total         = section.settings.total | times: 1
  assign _items_resp    = section.settings.items_resp | default: '5,3,2'
  assign _enable_slider = true
-%}

{%- capture section_class -%}
  {{- -}}related-product
  {{- -}}|section-{{- section.id -}}
  {%- render 'bgset' ,class: 'bg-image' ,image: section.settings.section_bg_image -%}
{%- endcapture -%}{%- assign section_class = section_class | strip | split: '|' | join: ' ' -%}
{%- assign sectionID = '.section-' | append: section.id -%}

{%- capture gridClass -%}{%- render 'set-item-per-row', value: _items_resp -%}{%- endcapture -%}
{%- capture productRecommend -%}{%- render 'product-detail-snippet', type: 'recommendation_product', product: product, limit: _total, gridClass: gridClass -%}{%- endcapture -%}

{%- capture content -%}
<div class="{{section_class}}" data-section-type="related-product" data-section-id="{{section.id}}">
  <div class="section_content-wrapper" style="position: relative;">

    {%- unless section.settings.sectionHeading_text_1 == blank and section.settings.sectionHeading_text_2 == blank -%}
      <div class="section_content-head">
        {%- include 'snippet-theme', type: 'sectionHeading' -%}
      </div>
    {%- endunless -%}

    <div class="section_content-body tns-wrapper">

      <div class="row{% if _enable_slider %} js-tns slide_ui-element{% endif %}" data-config="tns-config-{{section.id}}">{{- productRecommend -}}</div>

      {%- if _enable_slider -%}
        {%- render 'set-item-per-row', type: 'slider', section: section, item_class: 'product-section' -%}
      {%- endif -%}

    </div>
  </div>
</div>
{%- capture sectionCss -%}
  {%- liquid
    echo section_css
    render 'snippet-theme', type: 'sectionCSS', ID: sectionID
  -%}

  {%- if _style == '2' -%}{%- render 'snippet-theme', type: 'productGridV2', sectionID: sectionID -%}{%- endif -%}
{%- endcapture -%}{%- assign sectionCss = sectionCss | strip_newlines -%}
{%- unless sectionCss == blank -%}<style>{{sectionCss}}</style>{%- endunless -%}
{%- endcapture -%}


{%- comment -%}
  **
  * Render Section
  *
{%- endcomment-%}

{%- liquid
  if section.settings.hide_with_sidebar and productLayoutStyle == 1
    assign hideSection = true
  endif
  unless hideSection
    unless productRecommend == blank
      assign blockVisible = section.settings.visible | strip_newlines | split: ','

      if blockVisible.size == 0 or blockVisible contains product.title
          render 'compress', content: content
      endif
    endunless
  endunless
-%}

{% schema %}
{
  "name": {
    "en": "Products recommendation"
  },
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "section_padding",
      "label": "Section Padding",
      "placeholder": {
        "en": "E.g: 5px 20px 5px 20px"
      },
      "info": {
        "en": "Order: Top Right Bottom Left"
      }
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": {
        "en": "Background color"
      }
    },
    {
      "type": "image_picker",
      "id": "section_bg_image",
      "label": {
        "en": "Background image"
      }
    },
    {
      "type": "select",
      "id": "section_bg_size",
      "label": {
        "en": "Background Size"
      },
      "default": "cover",
      "options": [
        {
          "value": "auto",
          "label": {
            "en": "Auto"
          }
        },
        {
          "value": "cover",
          "label": {
            "en": "Cover"
          }
        },
        {
          "value": "contain",
          "label": {
            "en": "Contain"
          }
        }
      ]
    },
    {
      "type": "select",
      "id": "section_bg_repeat",
      "label": {
        "en": "Background Image Repeat:"
      },
      "default": "no-repeat",
      "options": [
        {
          "value": "no-repeat",
          "label": {
            "en": "No Repeat"
          }
        },
        {
          "value": "repeat",
          "label": {
            "en": "Repeat"
          }
        },
        {
          "value": "repeat-x",
          "label": {
            "en": "Repeat X"
          }
        },
        {
          "value": "repeat-y",
          "label": {
            "en": "Repeat Y"
          }
        }
      ]
    },
    {
      "type": "select",
      "id": "section_bg_position",
      "label": {
        "en": "Background Image Position:"
      },
      "default": "center center",
      "options": [
        {
          "value": "left top",
          "label": {
            "en": "Left Top"
          }
        },
        {
          "value": "center top",
          "label": {
            "en": "Center Top"
          }
        },
        {
          "value": "right top",
          "label": {
            "en": "Right Top"
          }
        },
        {
          "value": "left center",
          "label": {
            "en": "Left Center"
          }
        },
        {
          "value": "center center",
          "label": {
            "en": "Center Center"
          }
        },
        {
          "value": "right center",
          "label": {
            "en": "Right Center"
          }
        },
        {
          "value": "left bottom",
          "label": {
            "en": "Left Bottom"
          }
        },
        {
          "value": "center bottom",
          "label": {
            "en": "Center Bottom"
          }
        },
        {
          "value": "right bottom",
          "label": {
            "en": "Right Bottom"
          }
        }
      ]
    },
    {
      "type": "header",
      "content": {
        "en": "Collection settings"
      }
    },
    {
      "type": "checkbox",
      "id": "enable_catalog",
      "label": {
        "en": "Enable Catalog mode"
      },
      "default": true
    },
    {
      "type": "text",
      "id": "total",
      "label": {
        "en": "Total items"
      },
      "default": "10",
      "placeholder": {
        "en": "E.g: 10"
      }
    },
    {
      "type": "text",
      "id": "items_resp",
      "label": {
        "en": "Max number of items per row"
      },
      "default": "5,3,2",
      "placeholder": {
        "en": "E.g: 4,3,2"
      }
    },
    {
      "type": "text",
      "id": "grid_spc",
      "label": {
        "en": "Spacing between items"
      },
      "info": {
        "en": "E.g: 10px"
      }
    },
    {
      "type": "header",
      "content": {
        "en": "Slider settings"
      }
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": {
        "en": "Enable Loop"
      }
    },
    {
      "type": "checkbox",
      "id": "controls",
      "label": {
        "en": "Show controls"
      },
      "default": true
    },
    {
      "type": "checkbox",
      "id": "dots",
      "label": {
        "en": "Show Dots"
      },
      "default": true
    },
    {
      "type": "header",
      "content": {
        "en": "Section Heading"
      }
    },
    {
      "type": "text",
      "id": "sectionHeading_text_1",
      "label": {
        "en": "Heading"
      },
      "default": "Customers albo bought"
    },
    {
      "type": "text",
      "id": "sectionHeading_text_2",
      "label": {
        "en": "Subheading"
      }
    },
    {
      "type": "select",
      "id": "sectionHeading_align",
      "label": {
        "en": "Alignment"
      },
      "options": [
        {
          "value": "auto",
          "label": {
            "en": "Auto"
          }
        },
        {
          "value": "left",
          "label": {
            "en": "Left"
          }
        },
        {
          "value": "center",
          "label": {
            "en": "Center"
          }
        },
        {
          "value": "right",
          "label": {
            "en": "Right"
          }
        }
      ],
      "default": "auto"
    },
    {
      "type": "color",
      "id": "sectionHeading_cl_1",
      "label": {
        "en": "Heading color"
      },
      "info": {
        "en": "Blank to inherit"
      }
    },
    {
      "type": "color",
      "id": "sectionHeading_cl_2",
      "label": {
        "en": "Subheading color"
      },
      "info": {
        "en": "Blank to inherit"
      }
    }
  ],
  "blocks": []
}
{% endschema %}